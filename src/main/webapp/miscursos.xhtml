<?xml version='1.0' encoding='UTF-8' ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:h="http://xmlns.jcp.org/jsf/html"
      xmlns:p="http://primefaces.org/ui"
      xmlns:f="http://xmlns.jcp.org/jsf/core">
    <h:head>
        <title>Mis cursos</title>
        <h:outputStylesheet library="css" name="principal.css"/>
    </h:head>
    <h:body style="background-image: url(img/fondo1-1.png)">
        <h:form>
            <p:toolbar style="height: 60px;
                       padding: 0px;
                       width: 100%;
                       height: 150px;
                       background: linear-gradient(150deg, #8b7171, #ac2925, #aa5857);
                       border: 0px;
                       ">
                <f:facet name="left">
                    <img src="img/LogouesP.png" height="90px" width="200px" 
                         style="margin-top: 25px;
                         margin-left: 50px" onclick="location.href = 'principal.jsf'"/>
                </f:facet>
                <f:facet name="right">
                    <p:commandButton  value="::" class="menu" rendered="#{manejadorLogin.loginadmin()}" oncomplete="PF('sidebar2').show()" 
                                      style="margin-top: 40px;
                                      margin-right: 20px;
                                      width: 100%;
                                      border: 0px !important;
                                      background: linear-gradient(150deg, #8b7171, #ac2925, #aa5857);
                                      color: azure" />
                </f:facet>
            </p:toolbar>



            <p:sidebar widgetVar="sidebar2" position="right" baseZIndex="10000">
                <h1 style="font-weight:normal">Administración de Cursos</h1>
                <!--   <p:commandButton value="Cancel" oncomplete="PF('sidebar2').hide()"/>-->
                <center>
                    <img src="img/logoues.png" width="200px" height="120px" onclick="location.href = 'principal.jsf'"/>
                </center>
                <br/><br/>
                <p:commandButton value="Nuevo Curso"  style="background: linear-gradient(150deg, #8b7171, #ac2925, #aa5857);
                                 color: azure" class="btnMenu" onclick="location.href = 'creacion.jsf'"/>
                <p:separator style="margin: 5px"/>
                <p:commandButton value="Mis cursos" style="background: linear-gradient(150deg, #8b7171, #ac2925, #aa5857);
                                 color: azure" class="btnMenu" onclick="location.href = 'miscursos.jsf'"/>
                <p:separator style="margin: 5px"/>
                <p:commandButton value="Cursos Archivados" class="btnMenu" 
                                 style="background: linear-gradient(150deg, #8b7171, #ac2925, #aa5857);
                                 color: azure"
                                 onclick="location.href = 'archivados.jsf'"/> <!--class="boton_personalizado"-->
                <p:separator style="margin: 5px"/>
                <p:commandButton value="Estadisticas" style="background: linear-gradient(150deg, #8b7171, #ac2925, #aa5857);
                                 color: azure" class="btnMenu"/>
                <p:separator style="margin: 5px"/>
                <p:commandButton value="Cerrar Sesión" style="background: linear-gradient(150deg, #8b7171, #ac2925, #aa5857);
                                 color: azure" class="btnMenu" action="#{manejadorLogin.cerrarsesion()}"/>
                <p:separator style="margin: 5px"/>
            </p:sidebar>
        </h:form>

        <h:form id="form">
            <p:growl id="mensaje" severity="info, fatal" showSummary="true" showDetail="true"/>
            <p:growl id="msgs" showDetail="true"/>    
            <p:dataTable var="cursoActivos" value="#{manejadorCursos.listaCursos}" paginator="true" rows="10"
                         paginatorTemplate="{RowsPerPageDropdown} {FirstPageLink} {PreviousPageLink} {CurrentPageReport} {NextPageLink} {LastPageLink}"
                         rowsPerPageTemplate="5,10,15" selectionMode="single" selection="#{manejadorCursos.curso}" id="idCursoSelected" lazy="true" rowKey="#{cursoActivos.idCurso}" >
                <p:ajax event="rowSelect" listener="#{manejadorCursos.onRowSelect}" update=":form:carDetail" />
                <f:facet name="header">
                    <h1>
                        Cursos Decanato UESFMOcc
                    </h1>
                </f:facet>
                <p:column headerText="Id"  >
                    <h:outputText value="#{cursoActivos.idCurso}" />
                </p:column>
                <p:column headerText="Nombre" >
                    <h:outputText value="#{cursoActivos.nombreCurso}" />
                </p:column>
                <p:column headerText="descripcion" >
                    <h:outputText value="#{cursoActivos.descripcion}" />
                </p:column>

            </p:dataTable>
            <p:contextMenu for="idCursoSelected">
                <p:menuitem value="Modificar" update="carDetail" oncomplete="PF('carCursos').show()"/>
                <p:menuitem value="Archivar" update="carArchivar" oncomplete="PF('carArchivar').show()"/>
                <p:menuitem value="Listado de estudiantes" action="#{manejadorCursos.llenarLista()}" update="carArchivar" oncomplete="PF('estudiantesCurso').show()"/>


            </p:contextMenu>

            <p:dialog header="Detalle curso seleccionado" widgetVar="carCursos" modal="true" showEffect="fade" hideEffect="fade" resizable="false">
                <p:outputPanel id="carDetail" style="text-align:center; 
                               border: none;
                               background: linear-gradient(150deg, #8b7171, #ac2925, #aa5857);
                               color: azure">
                    <p:panelGrid id="panel" columns="3" layout="grid"  style="width: 775px; height: 300px"> 
                        <p:outputLabel for="nombreCurso"  value="Nombre" />
                        <p:inputText id="nombreCurso" value="#{manejadorCursos.curso.nombreCurso}" required="true" requiredMessage="Nombre requerido" maxlength="25"/>
                        <p:message for="nombreCurso" />

                        <p:outputLabel for="descripcionCurso" value="Descripcion" />
                        <p:inputTextarea id="descripcionCurso" value="#{manejadorCursos.curso.descripcion}" required="true" requiredMessage="Descripcion requerida" maxlength="300"/>
                        <p:message for="descripcionCurso" />


                        <p:outputLabel for="fechaInicio" value="Fecha inicio" />
                        <p:calendar id="fechaInicio" value="#{manejadorCursos.curso.fechaInicio}" required="true" requiredMessage="Fecha inicio requerida" mask="99/99/99"/>
                        <p:message for="fechaInicio" />


                        <p:outputLabel for="fechaFin" value="Fecha fin" />
                        <p:calendar id="fechaFin" value="#{manejadorCursos.curso.fechaFin}" required="true" requiredMessage="Fecha fin requerida" mask="99/99/99" />
                        <p:message for="fechaFin" />


                        <p:outputLabel for="cupo" value="Capacidad" />
                        <p:inputNumber id="cupo" class="input1" placeholder="cupo" value="#{manejadorCursos.curso.cupo}" minValue="0" maxValue="999"  required="true" requiredMessage="Cupo requerido" />
                        <p:message for="cupo" />

                        <p:outputLabel />
                        <p:commandButton value="Editar" action="#{manejadorCursos.editarcurso()}" update="mensaje, panel, form, idCursoSelected" />
                    </p:panelGrid>
                </p:outputPanel>
            </p:dialog>
            <p:dialog header="Car Detail" widgetVar="carArchivar" modal="true" showEffect="fade" hideEffect="fade" resizable="false">
                <p:outputPanel id="carArchivar" style="text-align:center; border: none">
                    <p:panelGrid  columns="2" rendered="#{not empty manejadorCursos.curso}" columnClasses="label,value">
                        <f:facet name="header">
                            <p:outputLabel value="¿Desea archivar Curso #{manejadorCursos.curso.nombreCurso} ?" />
                        </f:facet>
                        <p:commandButton id="archivarSI" value="SI" action="#{manejadorCursos.archivarCurso()}" update="mensaje, panel,form,idCursoSelected"/>
                        <p:commandButton id="archivarNO" value="NO" oncomplete="PF('carArchivar').hide()" />
                    </p:panelGrid>
                </p:outputPanel>
            </p:dialog>
            <p:dialog header="Estudiantes del curso" widgetVar="estudiantesCurso" modal="true" style="background: linear-gradient(150deg, #8b7171, #ac2925, #aa5857);
                      color: azure" showEffect="fade" hideEffect="fade" resizable="false">
                <p:dataTable id="estudiantesCursos" var="estudiantes" value="#{manejadorCursos.estudiantesCurso}">
                    <div style="float: right; padding-top: 5px">
                        <h:commandLink>
                            <p:graphicImage url="img/logoues.png" width="24" title="Exportar a PDF"/>
                            <p:dataExporter type="pdf" target="estudiantesCursos" fileName="Ejemplo"/>
                        </h:commandLink>
                    </div>
                    <p:column 
                        headerText="ID">
                        <h:outputText value="#{estudiantes.idEstudiante}"/>
                    </p:column>
                    <p:column
                        headerText="nombre">
                        <h:outputText value="#{estudiantes.nombreEstudiante}"/>
                    </p:column>
                    <p:column headerText="correo">
                        <h:outputText value="#{estudiantes.correoEstudiante}"/>
                    </p:column>
                </p:dataTable>
            </p:dialog>
        </h:form>
        <f:metadata>
            <f:viewAction action="#{manejadorLogin.loginPrincipal()}" />
        </f:metadata>
    </h:body>
</html>

